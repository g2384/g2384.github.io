<meta charset="UTF-8" />
<head>
<title>24 Game(24点) Calculator and Even More</title>
<style>body { margin: 0; padding: 20px 20px;font-size:18px;line-height:130%;}
#n{width:300px;}
#result{font-family:"Courier New", Courier, monospace;}
.btn{
margin: 10px 10px;
padding: 5px 8px;
font-size: 16px;
line-height: 1.33;
border-radius: 3px;
color: #333;
border-color: #ccc;
cursor: pointer;
text-align: center;
white-space: nowrap;
border: 1px solid rgb(194, 194, 194);}
.btn:hover{background-color:#afd9ee}
#selectAll{display:none;}
input[type="checkbox"] + label {
    display:inline-block;
    width:19px;
    height:19px;
    margin:-1px 4px 0 0;
}
label{cursor:pointer;}
label:hover{color:#555;}
input[type="text"]{margin:5px 0px;height:30px;}
</style>
</head>
<body>
<h2><u>24 Game(24点)</u> / <u>Countdown Solver</u> and Even More</h2>
<h3>This page helps you to <u>use operators(+, -, ×, ÷) and given numbers to get any desired results</u></h3>
1. Enter numbers, separate with ","(comma), e.g. "11,11,11,12";<br>
2. To calculate the <strong>range</strong> these numbers can generate (e.g. 4, 2, 1 can generate all numbers between 1 to 10), set "Lower limit" and "Upper limit" to be valid integers.<br>
3. To calculate <strong>one specific result (e.g. 24)</strong>, set "Lower limit" = "Upper limit" = your integer.<br>
**Only +, -, ×, ÷, and (), are considered.<br><br>
<strong>Interesting facts:</strong><br>
you can use<br>
&nbsp;&nbsp;&nbsp;&nbsp;2 and 1 to calculate the number from 1 to 3;<br>
&nbsp;&nbsp;&nbsp;&nbsp;4, 2 and 1 to calculate 1 ~ 10; <br>
&nbsp;&nbsp;&nbsp;&nbsp;[4, 4, 6, 6, 60] to get 1 ~ 100 (Except for 84, 99); <br>
&nbsp;&nbsp;&nbsp;&nbsp;[2, 8, 9, 12, 13] to get 1 ~ 271; 
<br><br>
Number: <input type="text" id="n" value="4,4,6,6,60" /><br>
Lower limit: <input type="text" id="lower" value="29" /><br>
Upper limit: <input type="text" id="upper" value="29" /><br>
<label><input type="checkbox" id="a" />Output All Possible Operations</label><br>
<input type="submit" value="Add Operators" class="btn" onClick="calc()">
<pre id="result"></pre>

<script>
Array.prototype.remove = function(from, to) {
    var rest = this.slice((to || from) + 1 || this.length);
    this.length = from < 0 ? this.length + from : from;
    return this.push.apply(this, rest);
};

function permute(input) {
    var permArr = [],
        usedChars = [];

    function main() {
        var i, ch;
        for (i = 0; i < input.length; i++) {
            ch = input.splice(i, 1)[0];
            usedChars.push(ch);
            if (input.length == 0) {
                permArr.push(usedChars.slice());
            }
            main();
            input.splice(i, 0, ch);
            usedChars.pop();
        }
        return permArr;
    }
    return main();
}

function removeDuplicated(c) {
    var l = c.length;
	var k=c[0].length;
	var t=true;
    for (var i = 0; i < k; i++) {
		for (var j = 0; j < k; j++) {
		if((c[0][i] == c[0][j]) && (i != j)){
			t=false;
		}
	}
	}
	if(t){
		return c;
	}
    for (var i = 0; i < l; i++) {
        for (var j = 0; j < l; j++) {
            if ((c[i].join("") == c[j].join("")) && (i != j)) {
                l--;
                c.remove(j);
                j--;
            }
        }
    }
    return c
}
String.prototype.regexIndexOf = function(pattern, startIndex) {
    startIndex = startIndex || 0;
    var searchResult = this.substr(startIndex).search(pattern);
    return (-1 === searchResult) ? -1 : searchResult + startIndex;
}
function calc() {
    var str = document.getElementById("n").value;
    var all = document.getElementById("a").checked;
    str = str.replace(/ |\s/g, "");
    var a = str.split(",");
    str = "";
    var upper = document.getElementById("upper").value;
    var lower = document.getElementById("lower").value;
    var c = permute(a);
    c = removeDuplicated(c);
    rs = generateEqu(c, a.length);
    //console.log(rs)
    str = "";
	var a3 = performance.now();
    for (var target = lower; target <= upper; target++) {
        var r = "";
        var s = target.toString();
        var s_neg = "-" + s;
        l = c.length;
        for (var i = 0; i < l; i++) {
            var u = rs[i].length;
            for (var j = 0; j < u; j++) {
                var equ = rs[i][j];
                if (eval(equ).toString() == s) {
                    rs[i].remove(j);
                    j--;
                    r += (equ + " = " + s);
                    if (!all) {
                        j = u;
                        i = l;
                    } else {
                        r += "<br>";
                    }
                    u--;
                } else if (eval(equ).toString() == s_neg) {
                    rs[i].remove(j);
                    j--;
                    r += ("-(" + equ + ") = " + s);
                    if (!all) {
                        j = u;
                        i = l;
                    } else {
                        r += "<br>";
                    }
                    u--;
                }
            }
        }
        if (r != "") {
			if(all){
				r+=extraEqu(l,rs,s,s_neg,all);
			}
            str = str + r + "<br>";
        } else {
            r=extraEqu(l,rs,s,s_neg,all);
            if (r != "") {
                str = str + r + "<br>";
            } else {

                str = str + "<strong>No result for " + s + "</strong><br>";
                if (all) {
                    str += "<br>";
                }
            }
        }
    }
    str = str.replace(/\(([0-9]+)\)/g, "$1")
    str = str.replace(/\(([0-9]+\*[0-9]+)\)(\*|\/)/g, "$1$2")
    str = str.replace(/\(([0-9\+\-\(\)]+)(\*|\/)([0-9]+)\)(\*|\/)/g, "$1$2$3$4");
    str = str.replace(/\*/g, "×");
    str = str.replace(/\/(\(|[0-9])/g, "÷$1");
    str = str.replace(/(<br>)+/g, "<br>");
	var b3 = performance.now();
	str = 'It took ' + parseInt(b3 - a3) + ' ms.<br>------<br>' + str;
    document.getElementById("result").innerHTML = str;
}
function isNumber(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
}
function extraEqu(l, rs, s, s_neg,all) {
    var r = "";
	var r_t="";
    for (var i = 0; i < l; i++) {
        var u = rs[i].length;
        for (var j = 0; j < u; j++) {
            var equ = rs[i][j];
            if (equ.regexIndexOf(/(\/|\*)([0-9]+[\+\-])/) >= 0) {
                equ = equ.replace(/(\/|\*)([0-9]+[\+\-])/, "$1($2");
                equ += ")";
                r_t=compEqu(equ,s,s_neg);
					if(r_t.length>0){
					r+=(r_t+"<br>")
					
					}
            }
            if (r == "" || all) {
			// ((6+7)+8+4)*5 -> ((6+7)+8+(4)*5)
                equ = rs[i][j];
                if (equ.regexIndexOf(/(\-|\+)([0-9]+\)[\*\/][0-9]+)$/) >= 0) {
                    equ = equ.replace(/(\-|\+)([0-9]+\)[\*\/][0-9]+)$/, "$1($2");
                    equ = equ.replace(/\(([0-9]+)\)$/g, "$1");
                    equ += ")";
                    r_t=compEqu(equ,s,s_neg);
					if(r_t.length>0){
					r+=(r_t+"<br>")
					
					}
                }
            }
			if (r == "" || all) {
			// (6+7)*8+4-5 -> (6+7)*(8+4)-5
                equ = rs[i][j];
                if (equ.regexIndexOf(/(\*|\/)([0-9]+[\+\-][0-9]+)/) >= 0) {
                    equ = equ.replace(/(\*|\/)([0-9]+[\+\-][0-9]+)/, "$1($2)");
                    r_t=compEqu(equ,s,s_neg);
					if(r_t.length>0){
					r+=(r_t+"<br>")
					
					}
                }
            }
			if (r == "" || all) {
			// (6+7)*8+4-5 -> (6+7)*(8+4-5)
                equ = rs[i][j];
                if (equ.regexIndexOf(/(\*|\/)([0-9]+[\+\-][0-9]+[\+\-][0-9]+)/) >= 0) {
                    equ = equ.replace(/(\*|\/)([0-9]+[\+\-][0-9]+[\+\-][0-9]+)/, "$1($2)");
                    r_t=compEqu(equ,s,s_neg);
					if(r_t.length>0){
					r+=(r_t+"<br>")
					
					}
                }
            }
			if (r !=""&&!all) {
				j = u;
				i = l;
				break;
			}

        }
    }
    return r;
}
function compEqu(equ,s,s_neg){
var r="";
var kk = eval(equ);
if (parseInt(kk) == kk) {
	kk = kk.toString();
	if (kk == s) {
		r = (equ + " = " + s);
	} else if (kk == s_neg) {
		r = ("-(" + equ + ") = " + s);
	}
}

return r;
}
function generateEqu(c, le) {
    var l = c.length,
        k = [];
    var l = c.length,
        le2 = le;
    var rn = [],
        rs = [],
        str = "";
    for (var i = 0; i < l; i++) {
        k = c[i];
        rs = [], le = le2;
        var u = Math.pow(4, --le);;
        for (var j = 0; j < u; j++) {
            rs[j] = k[0].toString();
        }
        var ln = Math.pow(4, le2 - 2);
        for (var z = 1; z < le2; z++) {
            var index = 0;
            var d = Math.pow(4, --le);
            for (var x = 0; x < ln; x++) {
                if (index < u) {
                    for (var y = 0; y < d; y++) {
                        rs[index] += ("+" + k[z].toString());
                        index++;
                    }
                    for (var y = 0; y < d; y++) {
                        rs[index] += ("-" + k[z].toString());
                        index++;
                    }
                    for (var y = 0; y < d; y++) {
                        rs[index] = "(" + rs[index] + ")*" + k[z].toString();
                        index++;
                    }
                    for (var y = 0; y < d; y++) {
                        rs[index] = "(" + rs[index] + ")/" + k[z].toString();
                        index++;
                    }
                }
            }
        }
        rn[i] = rs;
    }
    return rn;
}
</script>
</body>
