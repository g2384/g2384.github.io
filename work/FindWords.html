<html>
<title>Find Words</title>
<meta charset='utf-8'>
<style>body{font-family:consolas}
.g{display:block;color:#888;}
.complimentary{color:#888;display:inline-block;margin-left:10px;}
.red{background-color:#eee;}
.btn{margin: 10px 10px;
padding: 5px 8px;
font-size: 16px;
line-height: 1.33;
border-radius: 3px;
color: #ff0000;
cursor: pointer;
text-align: center;
background-color:white;
border: 1px solid rgb(194, 194, 194);}
.btn:hover{background-color:#eee}
#w{
    padding: 10px;
    border:  solid 1px gainsboro;
    border-bottom: solid 2px #c9c9c9;
	transition: border 0.3s;
    margin: 0;
    width: 300px;
    font-size: 18px;
    -webkit-appearance: none;
	box-shadow: none;
	box-sizing: border-box;	
}
#w:focus{border-bottom: solid 2px #969696;}
#exmp{color:red;cursor:pointer;display:inline-block}
#exmp:hover{background-color:red;color:white}
</style>
<script src="FindWordsDict.js"></script>
<script>
var arr = [];
var len = [-1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];
var lend = [0, 0, 0, 0, 0, 1, 2];
var lenjp = [0, 0, 0, 1, 2, 3, 4];

function search() {
    var s = document.getElementById('w').value;
    var eng = document.getElementById('eng').checked;
    var jpw = document.getElementById('jpw').checked;
    var r_div = document.getElementById('r');
    var final_s = '----------<br>';
    var s_len = s.length;
    s = s.toLowerCase();
    s = s.replace(/[ \t]*/g, "");
    var start = new Date().getTime();
    if (eng) {
        var s2 = s.replace(/\./g, '[a-z]')
        s2 = s2.replace(/[0-9]/g, '[a-z]');
        var s4 = s.replace('-', '');
        var smatch = s.match(/\[[^\[\]]+\][\+\*]?/g);
        if (smatch != null) {
            for (var i = 0; i < smatch.length; i++) {
                //s = s.replace(smatch[i], i.toString());
                if (smatch[i].indexOf("-") >= 0) {
                    r_div.innerHTML = final_s + "regex cannot contain '-', use [abcd] instead.";
                    return;
                }
            }
            if (s.indexOf('+') >= 0) {
                if (s.indexOf('+-') < 0) {
                    s = s.replace(/\+/g, "+-");
                }
            } else if (s.indexOf(']-') < 0) {
                s = s.replace(/\]/g, "]-");
            }
        }

        var re = new RegExp(s2);
        var result = [];
        var s_a = s.split('');
        var f = []
        if (s.indexOf('-') < 0) {
            if (s.match(/^\([a-z]*[^a-z]?[a-z]*\)$/) != null) {
                // scrabble
                var scrabbleArr = s.substring(1, s.length - 1).split(/[^a-z]/);
                var scrabbleMust = new RegExp('[a-z]*' + scrabbleArr[0].split("").sort().join('[a-z]*') + '[a-z]*');
                var comb = combinations(scrabbleArr.join(''));
                var inputset = new Set(s.substring(1, s.length - 1).split(""));
                var sortedComb = new Array(s.length - 4).fill("");
                comb = Array.from(new Set(comb));
                for (i = 0; i < comb.length; i++) {
                    var combiLen = comb[i].length;
                    if (combiLen > 2 && combiLen <= 13) {
                        sortedComb[combiLen - 3] += comb[i].split("").sort().join("") + ',';
                    }
                }
                for (i = 0; i < sortedComb.length; i++) {
                    sortedComb[i] = sortedComb[i].split(',');
                }
                var f1 = new Array();
                for (i = 0; i < sortedComb.length; i++) {
                    if (sortedComb[i][0].length == 0) {
                        continue;
                    }
                    array = a[len[sortedComb[i][0].length]].match(new RegExp("\\b[" + (Array.from(inputset)).join("") + ']+\\b', 'g'));
                    if (array != undefined) {
                        arr_len = array.length;
                        for (var j = 0; j < arr_len; j++) {
                            var sortedArr = array[j].split("").sort().join("");
                            if (sortedComb[sortedArr.length - 3].indexOf(sortedArr) >= 0) {
                                if (sortedArr.length < scrabbleMust.length) {
                                    f.push(array[j])
                                } else {
                                    if (sortedArr.replace(scrabbleMust, '').length > 0) {
                                        f.push(array[j])
                                    } else {
                                        f1.push('<span class=red>' + array[j] + '</span>')
                                    }
                                }

                            }
                        }
                    }
                }
                f = f1.concat(f);
                f = GetComplimentary(f, scrabbleArr);
            } else {
                var s_ = a[len[s_len]];
                var array = s_.split(',');
                var arr_len = array.length;
                for (var i = 0; i < arr_len; i++) {
                    if (array[i].replace(re, '') == '') {
                        result.push(array[i])
                    }
                }
                if (s.replace(/[0-9]/g, '').length != s_len) {
                    for (var i = 0; i < result.length; i++) {
                        var r_i = result[i].split('')
                        var keep = true;
                        for (var j = 1; j < r_i.length; j++) {
                            for (var k = j; k < r_i.length; k++) {
                                if (keep) {
                                    if (s_a[k] != s_a[k - j]) {
                                        keep = r_i[k] != r_i[k - j]
                                    } else {
                                        keep = r_i[k] == r_i[k - j]
                                    }
                                }
                            }
                        }
                        if (keep) {
                            f.push(result[i])
                        }
                    }
                } else {
                    f = result;
                }
            }
        } else {
            s = s.replace(/\+\-/g, "+");
            s = s.replace(/\]\-/g, "\]");
            s4 = s4.replace(/\[[^\[\]]+\][\+]*/g, '');
            s2 = s2.replace(/\-/g, '[a-z]*');
            s_len = s4.length > 1 ? s4.length - 1 : 1;
            re = new RegExp(s2);
            for (i = s_len; i < a.length; i++) {
                array = a[i].split(',');
                arr_len = array.length;
                for (var j = 0; j < arr_len; j++) {
                    if (array[j].replace(re, '') == '') {
                        f.push(array[j])
                    }
                }
            }
        }
    } else {
        var s2 = s.replace(/[A-Za-z0-9]/g, '.')
        s2 = s2.replace(/[，。]/g, '')
        var re = new RegExp(s2);
        var result = [];
        var s_a = s.split('');
        var f = []
        var dict = d;
        var dictlen = lend
        if (jpw) {
            dict = jp;
            dictlen = lenjp;
        }
        
        if (s.indexOf(']') >= 0) {
            re = new RegExp(s);
            for (i = 0; i < dict.length; i++) {
                array = dict[i].split(',');
                arr_len = array.length;
                for (var j = 0; j < arr_len; j++) {
                    if (array[j].replace(re, '') == '') {
                        f.push(array[j])
                    }
                }
            }
        } else if (s.indexOf('-') < 0) {
            var s_ = dict[dictlen[s_len]];
            var array = s_.split(',');
            var arr_len = array.length;
            for (var i = 0; i < arr_len; i++) {
                if (array[i].replace(re, '') == '') {
                    result.push(array[i])
                }
            }
            if (s.replace(/[A-Za-z0-9]/g, '').length != s_len) {
                for (var i = 0; i < result.length; i++) {
                    var r_i = result[i].split('')
                    var keep = true;
                    for (var j = 1; j < r_i.length; j++) {
                        for (var k = j; k < r_i.length; k++) {
                            if (keep) {
                                if (s_a[k] != s_a[k - j]) {
                                    keep = r_i[k] != r_i[k - j]
                                } else {
                                    keep = r_i[k] == r_i[k - j]
                                }
                            }
                        }
                    }
                    if (keep) {
                        f.push(result[i])
                    }
                }
            } else {
                f = result;
            }
        } else {
            var s3 = s2.replace('-', '');
            s2 = s2.replace('-', '.*');
            s_len = s3.length > 3 ? s3.length - 4 : 0;
            re = new RegExp(s2);
            for (i = s_len; i < dict.length; i++) {
                array = dict[i].split(',');
                arr_len = array.length;
                for (var j = 0; j < arr_len; j++) {
                    if (array[j].replace(re, '') == '') {
                        f.push(array[j])
                    }
                }
            }
        }
    }

    var end = new Date().getTime();
    var time = (end - start) / 1000;
    if (f.length > 0) {
        r_div.innerHTML = final_s + 'Execution time: ' + time + 'ms<br>Found ' + f.length + ' words<br>' + f.join('<br>')
    } else {
        r_div.innerHTML = final_s + 'Execution time: ' + time + 'ms<br>Found nothing';
    }

}

function show() {
    var pp = document.getElementById('exp')
    if (pp.style.display != 'none') {
        pp.style.display = 'none'
    } else {
        pp.style.display = '';
    }
}

function GetComplimentary(f, inputArray) {
    fullWords = new Array(f.length);
    var sortedWords = new Array(f.length);
    for (var i = 0; i < f.length; i++) {
        sortedWords[i] = f[i].split("").sort().join("");
    }
    var input = inputArray.join("");
    for (var i = 0; i < f.length; i++) {
        fullWords[i] = f[i];
        var cloneInputArray = input.split("");
        var word = f[i].split("");
        for (var j = 0; j < word.length; j++) {
            var index = cloneInputArray.indexOf(word[j]);
            if (index >= 0) {
                cloneInputArray.splice(index, 1);
            }
        }
        var leftLetters = cloneInputArray.sort().join("");
        var found = false;
        for (var k = 0; k < sortedWords.length; k++) {
            if (sortedWords[k] == leftLetters) {
                fullWords[i] += "<div class='complimentary'>";
                if (found) {
                    fullWords[i] += " / ";
                } else {
                    fullWords[i] += " + ";
                    found = true;
                }
                fullWords[i] += f[k] + "</div>";
            }
        }
    }
    return fullWords;
}

function combinations(str) {
    var fn = function(active, rest, a) {
        if (!active && !rest)
            return;
        if (!rest) {
            a.push(active);
        } else {
            fn(active + rest[0], rest.slice(1), a);
            fn(active, rest.slice(1), a);
        }
        return a;
    }
    return fn("", str, []);
}
</script>
<body>
<h2>Find Words</h2>
<input type='text' id='w' value='a..' onkeydown = "if (event.keyCode == 13) document.getElementById('s').click()"><br>
<label><input type='radio' name='k' id='eng' checked>English</label>
<label><input type='radio' name='k' id='ido'>成语</label>
<label><input type='radio' name='k' id='jpw'>日本語</label>
<input type='button' id='s' value='Search' onclick='search()' class='btn'><br>
Usage:<br>
letters a-z for known letters<br>
. for any letters<br>
numbers 0-9 for unknown & unique letters<br>
<br>
<div onclick='show()' id='exmp'>Examples</div>
<div id='exp' style='display:none'>
<div class='g'>"I need a three-letter word, <br>
I only know the 1st letter is 'a'"<br></div>
-- use <strong>a..</strong> to get axe, add ...<br><br>
<div class='g'>"I need a three-letter word, <br>
I know the 1st letter is 'a', <br>
the 2nd and 3rd place are the same."<br></div>
-- use <strong>a11</strong> to get add, ann ...<br><br>
<div class='g'>"I need a three-letter word, <br>
I know the 1st letter is 'a', <br>
the 2nd and 3rd place are definitely different."<br></div>
-- use <strong>a12</strong> to get axe, amp ...<br><br>
<div class='g'>"I need a word, <br>
I want it is ended with 'ing'."<br></div>
-- use <strong>-ing</strong> to get king, sing ...<br><br>
<div class='g'>"I need a word, <br>
It is started with 'k', <br>
and ended with 'ing'."<br></div>
-- use <strong>k-ing</strong> to get king, kiting ...<br><br>
<div class='g'>"I am playing scrabble, <br>
I have these letters 'k', 'c', 'o', 'l', 'e', 't'."<br></div>
-- use <strong>(kcolet)</strong> to get locket, lock ...<br><br>
<div class='g'>"I am playing scrabble, <br>
I have these letters 'k', 'c', 'o', 'l', 'e', 't'<br>
and it must contain 'k', 'c', 'o'"<br></div>
-- use <strong>(kco:let)</strong> to get locket, lock ...<br><br>
<div class='g'>"I need a word, <br>
It can be started with 'a', 'b', 'c' and ended with 'e'."<br></div>
-- use <strong>[abc]-e</strong> to get acing, boring ...<br><br>
<div class='g'>"I need a word, <br>
It can be formed by 'a', 'b', 'c'."<br></div>
-- use <strong>[abc]+</strong> to get cab, baba ...<br><br>
<div class='g'>"I need a word, <br>
It can be formed by 'a', 'b', 'c', 'd', 'e', 'f', <br>
and I know the 1st letter is c."<br></div>
-- use <strong>c[abcdef]+</strong> to get cab, cafe ...<br><br>
Try 'AABB', '一.一.', '1123' to search 成语.
Try 'AABB', 'ああ-', '1123' to search 日本語.
</div><br><br>
(Word list size: 108554)<br>
(成语: 12553词)<br>
(日本語: 21126個)<br>
<div id='r'></div>
</body>
</html>