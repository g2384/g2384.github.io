<html>
<title>Mental Calculator</title>
<meta charset='utf-8'>
<body>
<style>body{font-size:16px;font-family: consolas;}
textarea {
	width: 600px;
	height: 50px;
	padding: 5px;
	font-size:16px;
}
#sel{
display:none}
.note{
display: block;
padding-bottom: 20px;padding-top: 10px;}
.btn{
margin: 10px 10px;
padding: 5px 8px;
font-size: 16px;
line-height: 1.33;
border-radius: 3px;
color: #333;
background-color: #fff;
cursor: pointer;
text-align: center;
white-space: nowrap;
border: 1px solid rgb(194, 194, 194);}
.btn:hover{color:red;}
.calc{background-color: #FFADAD;border: 0px solid;}
.sec{color:red;}
#example{color:red;cursor:pointer;display:inline-block}
#example:hover{background-color:red;color:white}
</style>
<script>
log_table="0.1=-1;0.2=-0.699;0.3=-0.523;0.4=-0.398;0.5=-0.301;0.6=-0.222;0.7=-0.155;0.8=-0.097;0.9=-0.046;1=0;1.1=0.041;1.2=0.079;1.3=0.114;1.4=0.146;1.5=0.176;1.6=0.204;1.7=0.23;1.8=0.255;1.9=0.279;2=0.301;2.1=0.322;2.2=0.342;2.3=0.362;2.4=0.38;2.5=0.398;2.6=0.415;2.7=0.431;2.8=0.447;2.9=0.462;3=0.477;3.1=0.491;3.2=0.505;3.3=0.519;3.4=0.531;3.5=0.544;3.6=0.556;3.7=0.568;3.8=0.58;3.9=0.591;4=0.602;4.1=0.613;4.2=0.623;4.3=0.633;4.4=0.643;4.5=0.653;4.6=0.663;4.7=0.672;4.8=0.681;4.9=0.69;5=0.699;5.1=0.708;5.2=0.716;5.3=0.724;5.4=0.732;5.5=0.74;5.6=0.748;5.7=0.756;5.8=0.763;5.9=0.771;6=0.778;6.1=0.785;6.2=0.792;6.3=0.799;6.4=0.806;6.5=0.813;6.6=0.82;6.7=0.826;6.8=0.833;6.9=0.839;7=0.845;7.1=0.851;7.2=0.857;7.3=0.863;7.4=0.869;7.5=0.875;7.6=0.881;7.7=0.886;7.8=0.892;7.9=0.898;8=0.903;8.1=0.908;8.2=0.914;8.3=0.919;8.4=0.924;8.5=0.929;8.6=0.934;8.7=0.94;8.8=0.944;8.9=0.949;9=0.954;9.1=0.959;9.2=0.964;9.3=0.968;9.4=0.973;9.5=0.978;9.6=0.982;9.7=0.987;9.8=0.991;9.9=0.996;10=1";
//var s='';for(var i=11;i<100;i+=1){s+=((Math.round(i*10)/10).toString()+'='+Math.round(Math.log(i)*1000)/1000).toString()+'\n'}console.log(s)
String.prototype.regexIndexOf = function(pattern, startIndex) {
	startIndex = startIndex || 0;
	var searchResult = this.substr(startIndex).search(pattern);
	return (-1 === searchResult) ? -1 : searchResult + startIndex;
}
function nthroot(n,m){
	var lo=log_table.split(';');
	for(i=0;i<lo.length;i++){
		lo[i]=lo[i].split('=');
		lo[i][1]=Number(lo[i][1]);
	}
	var ns=n.toString();
	var n_len=ns.length;
	n=Number(n);
	var ms=m.toString();
	var m_len=ms.length;
	m=Number(m);
	console.log(n_len,m)
	var new_n = '';
	var n_0 = 0;
	var new_nn=0;
	if(n_len<m){
		return 'The second number must be greater than the number of digits of the first number'
	}
	if(ms.indexOf('.')<0){
		//int
		if(m<=0){
			return 'Error'
		}else if(m<n_len){
			var ka=ns.substr(0,n_len-m);
			var kb=ns.substring(n_len-m,n_len)
			console.log(ka,kb)
			h = ka.length;
			new_n=ka.substring(0,1)+'.'+ka.substring(1,h)+kb;
			n_0 = h-1
		}
		new_nn=Math.round(Number(new_n)*10)/10;
		console.log(new_n, n_0, new_nn)
		
	}
	var new_n2=new_nn.toString();
	var r=0,r1='nthroot('+n+', '+m+'): <br>', r2='',r3='',r4='';
	for(i=0;i<lo.length;i++){
		if(lo[i][0]==new_n2){
			r=lo[i][1];
			console.log(new_n2)
		}
	}
	if(n_0>0){
		r+=n_0;
		if(n_0==1){
			r2='(log('+new_n2+')'+' + log(10))';
		}else{
			r2='(log('+new_n2+')'+' + '+n_0+'log(10))';
		}
	}else{
		r2='log('+new_n2+')';
	}
	r3=r.toString()
	r = Math.round(r/m*1000)/1000+1;
	r4=r.toString();
	var r5=calcpow(10, r, lo);
	return 'log('+ns+')/'+ms+' = log(x)<br>'+r2+'/'+m+' + 1 = log(x)<br>look up log table<br>'+r3+'/'+m+' + 1 = '+r4+' = log(x) <br>x = 10<sup>'+r4+'</sup> = '+r5[0]+'<br><br>Result: '+r5[1]+"<br>Calculator's result: " + Math.round(Math.pow(n,1/m)*1000)/1000;
}

function calcpow(n,m, lo){
	var ms=m.toString();
	var ms0=-1;
	if(ms.indexOf('.')>0){
		ms0=parseInt(ms.split('.')[0]);
	}
	if(n==10){
		m-=ms0;
		var min=999;
		var x='';
		var v=0;
		for(i=0;i<lo.length;i++){
			var kk=lo[i][1]-m;
			kk=kk>0?kk:kk*-1;
			if(kk<min){
				min=kk;
				v=lo[i][1];
				x=lo[i][0];
			}
		}
		console.log(min,x)
		var r = Number(x)*Math.pow(10,ms0);
		return ['10<sup>'+ms0+'</sup> × 10<sup>'+Math.round(m*1000)/1000+'</sup>' + ' ≈ 10<sup>'+ms0+'</sup> × 10<sup>'+Math.round(v*1000)/1000+'</sup> = ' + Math.pow(10,ms0)+' × '+x, r];
	}
}
function mult(m,n){
	var ns=n.toString();
	var n_len=ns.length;
	n=Number(n);
	var ms=m.toString();
	var m_len=ms.length;
	m=Number(m);
	console.log(n_len,m)
	var new_n = '';
	var n_0 = 0;
	var new_nn=0;
	if(m_len==n_len&&n_len>0){
		var na = ns.match(/.{1,2}/g);
		var ma = ms.match(/.{1,2}/g);
		var rs = '',rs2='';
		var kk=2;
		if(n_len%2){
			kk=1;
		}
		var kk2='00';
		if(n_len%2){
			kk2='0';
		}
		rs2 = mult_comb(na,ma,kk,kk2);
		res=eval(rs2[0].replace(/×/g,'*'));
		return rs2[1] + '<br> = '+ res + '<br><br>Long multiplication:<br>'+rs2[2]+Array(n_len*2+1).join("-")+'<br>'+ res+"<br><br>Calculator's result: "+m*n;
	}else{
		return 'Invalid input. Multiplicands must have the same digits';
	}
}
function mult_comb(na,ma,kk,kk2){
	var pp = {},pp2={};
	for(i=0;i<na.length;i++){
		for(j=0;j<na.length;j++){
			if(pp[i+j] == undefined){
				pp[i+j]=(na[i]+'×'+ma[j])
				pp2[i+j]=[na[i]+'*'+ma[j]]
			}else{
				pp[i+j]+=(' + '+na[i]+'×'+ma[j])
				pp2[i+j].push(na[i]+'*'+ma[j])
			}
		}
	}
	var rs='',rs2='',rs3='';
	var nn=(na.length-1)*2;
	var np=1;
	if(kk2=='00'){
		np=1;
	}else{
		np=0;
	}
	for(i=0;i<=nn;i++){
		rs += ' + ('+pp[i]+') × 1' + Array((nn-i)*2+1).join("0");
	}for(i=0;i<=nn;i++){
		rs2 += ' + ('+pp[i]+') × 10<sup>' + ((nn-i)*2+1)+'</sup>';
	}
	for(i=0;i<=nn;i++){
		for(j=0;j<pp2[i].length;j++){
			var kp=eval(pp2[i][j]).toString();
			if(i>0){
			kp = kp.length==4?kp:"&nbsp;"+kp;
			}
			console.log(kp)
			rs3 += Array(i*2).join("&nbsp;")+kp+'<br>';
			console.log(i,Array(i*2).join("&nbsp;")+eval(pp2[i][j]))
		}
	}
	return [rs.substring(3,rs.length-4), rs2.substring(3,rs2.length-17),rs3]
}
function calc(){
document.getElementById('result').innerHTML='Result:<br>'+eval(document.getElementById('exp').value);
}
function show(){
	var pp=document.getElementById('exmp')
	if(pp.style.display!='none'){
		pp.style.display='none'
	}else{
		pp.style.display='';
	}
}
</script>
<textarea id='exp'>mult(123456, 234567)
</textarea>
<input type='button' class='btn calc' value='Calc' onclick='calc();'/>
<br>
<span onclick='show()' id='example'>Example:</span>
<div id='exmp'>mult(123456, 234567) = 123456 × 234567<br>
nthroot(12345678,14) = 14√&#773;1&#773;2&#773;3&#773;4&#773;5&#773;6&#773;7&#773;8<br><br>
</div>
<div id='result'></div>
</body></html>
