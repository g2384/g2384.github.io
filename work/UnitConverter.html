<meta charset='utf-8'>
<title>Unit converter</title>
<style>
#contents {
    margin: 10px;
    display: inline-block;
}
input {font-size:100%;padding:5px;}
#unit_to,#unit_from{width:110px}
input[type='button'] {margin: 10px 10px;
padding: 5px 8px;
font-size: 16px;
line-height: 1.33;
border-radius: 3px;
color: #333;
background-color: #fff;
cursor: pointer;
text-align: center;
white-space: nowrap;
border: 1px solid #B3B3B3;}
input[type='button']:hover{color:#59aaf4;}
ul{max-width:209px; margin-left: 214px;padding:0px;border:1px solid #B3B3B3;border-radius: 3px;display:none;}
li { display: block;position: relative;
    margin: 0 -1px;
    padding: 6px 40px 6px 10px;
    color: #888;
    font-weight: 500;
    text-shadow: 0 1px #fff;
    border: 1px solid transparent;
    border-radius: 3px; cursor:pointer;}
li:hover {
    text-decoration: none;
    color: #fff;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.3);
    border-color: #2380dd #2179d5 #1a60aa;
    background-color: #338cdf;
    background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #59aaf4), color-stop(100%, #338cdf));
    background-image: -webkit-linear-gradient(top, #59aaf4, #338cdf);
    background-image: -moz-linear-gradient(top, #59aaf4, #338cdf);
    background-image: -ms-linear-gradient(top, #59aaf4, #338cdf);
    background-image: -o-linear-gradient(top, #59aaf4, #338cdf);
    background-image: linear-gradient(top, #59aaf4, #338cdf);
    -webkit-box-shadow: inset 0 1px rgba(255, 255, 255, 0.2), 0 1px rgba(0, 0, 0, 0.08);
    -moz-box-shadow: inset 0 1px rgba(255, 255, 255, 0.2), 0 1px rgba(0, 0, 0, 0.08);
    -ms-box-shadow: inset 0 1px rgba(255, 255, 255, 0.2), 0 1px rgba(0, 0, 0, 0.08);
    -o-box-shadow: inset 0 1px rgba(255, 255, 255, 0.2), 0 1px rgba(0, 0, 0, 0.08);
    box-shadow: inset 0 1px rgba(255, 255, 255, 0.2), 0 1px rgba(0, 0, 0, 0.08);
}
.noresult{padding: 7px;display: inline-block;}
</style>
<body><h2>Unit converter</h2>
<input type='text' id='val_from' onclick='hide_drop()' placeholder='value' value='1'>
<input type='text' id='unit_from' onclick='search("from")' data-type='' onkeyup='search("from")' placeholder='unit (FROM)'><br>
<ul id='drop_from'></ul><br>
<input type='text' id='val_to' onclick='hide_drop()' placeholder='value'>
<input type='text' id='unit_to' onclick='search("to")' data-type='' onkeyup='search("to")' placeholder='unit (TO)'><br><ul id='drop_to'></ul><br>
<input type='button' onclick='convert()' value=Convert>
<script>
units=[
'm (meter)',' distance length meter meter m ',
'dm (decimeter)',' distance length decimeter dm ',
'cm (centimeter)',' distance length centimeter cm ',
'um (micrometer)',' distance length micrometer um ',
'inch',' distance length imperial us inch ',
'thou/mil',' distance length imperial us thou mil ',
'line',' distance length imperial us line ',
'foot',' distance length imperial us foot ',
'yard',' distance length imperial us yard ',
'mile',' distance length imperial us mile ',
'league',' distance length imperial us league ',
'fathom',' distance length marine fathom ',
'nautical mile',' distance length marine nautical mile ',
'ly (light year)',' distance length light year ly ',
'AU (astronomical unit)',' distance length astronomical unit au ',
'pc (parsec)',' distance length parsec pc ',
'min (minute)', ' time minute min m ',
'h (hour)', ' time hour hr h ',
's (second)', ' time second sec s ',
'rad/s', ' frequency radian per second rad r ',
'°C (Celsius)', ' temperature celsius degree centigrade c ',
'°F (Fahrenheit)', ' temperature fahrenheit degree f ',
'K (Kelvin)', ' temperature kelvin degree k ',
'km (kilometer)', ' distance length kilometer km '
];
var l = units.length;
var timeo;
var se = ''
String.prototype.regexIndexOf = function(pattern, startIndex) {
	startIndex = startIndex || 0;
	var searchResult = this.substr(startIndex).search(pattern);
	return (-1 === searchResult) ? -1 : searchResult + startIndex;
}
function search(sel) {
    clearTimeout(timeo);
    timeo = setTimeout(search_, 500);
    se = sel;
    if (se == 'to') {
        document.getElementById('drop_from').style.display = 'none';
    } else {
        document.getElementById('drop_to').style.display = 'none';
    }
}

function search_() {
    var s = document.getElementById('unit_' + se).value.toLowerCase();
	document.getElementById('unit_' + se).setAttribute('data-type', '');
    s = s.replace(/[^a-z \-\*\/]+/g, '');
    s = s.replace(/[ ]+$/g, '');
    if (s.length > 0) {
        var sa = s.split(' ');
        var ra = ';';
        var rac = [];
        var rat = [];
        var racc = 0;
        for (var i = 1; i < l; i += 2) {
            for (var j = 0; j < sa.length; j++) {
                if (units[i].indexOf(' ' + sa[j] + ' ') >= 0) {
                    if (ra.indexOf(';' + units[i - 1] + ';') < 0) {
                        ra += units[i - 1] + ';';
						rat.push(units[i].split(' ')[1])
                    }
                    if (racc < ra.length) {
                        rac.push(10);
                        racc++;
                    } else {
                        rac[racc]+=10;
                    }
                }/*else if (units[i].regexIndexOf(new RegExp('( '+sa[j]+'|'+sa[j] + ' )')) >= 0) {
                    if (ra.indexOf(';' + units[i - 1] + ';') < 0) {
                        ra += units[i - 1] + ';';
						rat.push(units[i].split(' ')[1])
                    }
                    if (racc < ra.length) {
                        rac.push(2);
                        racc++;
                    } else {
                        rac[racc]+=2;
                    }
                }*/else if (units[i-1].indexOf(sa[j]) >= 0) {
                    if (ra.indexOf(';' + units[i - 1] + ';') < 0) {
                        ra += units[i - 1] + ';';
						rat.push(units[i].split(' ')[1])
                    }
                    if (racc < ra.length) {
                        rac.push(0);
                        racc++;
                    } else {
                        rac[racc]++;
                    }
                }
            }
        }
        var result = '';
        ra = ra.substring(1, ra.length - 1)
        var kk = getSorted(ra.split(';'), rat,rac)
        for (var i = 0; i < kk[0].length; i++) {
            if (kk[0][i].length > 0) {
                result += '<li onclick="selectUnit(\'' + kk[0][i].split(' (')[0] + '\',\'' + se + '\',\'' + kk[1][i] + '\')">' + kk[0][i] + '</li>';
            }
        }
        var dr = document.getElementById('drop_' + se);
        dr.style.display = 'block';
        if (result.length > 0) {
            dr.innerHTML = result;
        } else {
            dr.innerHTML = '<span class=noresult>What is <font color=red>' + s + '</font> ʕ •̀ ω •́ ʔ</span>'
        }
    }
}

function getSorted(arr, arr2,sortArr) {
    var result = [];
	var sorted=false;
	var kp=0;
	var l=arr.length-1;
	while(!sorted&&kp<16){
		sorted=true;kp++;
		for (var i = 0; i < l; i++) {
			if (sortArr[i+1] > sortArr[i]) {
				var j=i+1;
				var a = arr[i];
				var b = sortArr[i];
				arr[i] = arr[j];
				arr[j] = a;
				var c = arr2[i];
				arr2[i] = arr2[j];
				arr2[j] = c;
				sortArr[i] = sortArr[j];
				sortArr[j] = b;
				sorted=false;
			}
		}
	}
    return [arr,arr2];
}

function selectUnit(a, sel,t) {
    var d=document.getElementById('unit_' + sel);
	d.value = a;
    d.setAttribute('data-type', t);
    hide_drop();
}

function hide_drop() {
    document.getElementById('drop_from').style.display = 'none';
    document.getElementById('drop_to').style.display = 'none';
}

function convert() {
    hide_drop();
    var v1 = Number(document.getElementById('val_from').value);
    var v2 = 0;
    var v = document.getElementById('val_to');
    var u1f = document.getElementById('unit_from');
    var u1 = u1f.value.split(' ')[0];
    var u2f = document.getElementById('unit_to');
    var u2 = u2f.value.split(' ')[0];
    var t = false;
    
	var u1_t=u1f.getAttribute('data-type'),u2_t=u2f.getAttribute('data-type');
	if(v1.length>0){
		v.value = 'Write a valid number (￣(ｴ)￣)';
        return;
	}
	if(u1_t==''){
		document.getElementById('drop_from').style.display='block';
		v.value='Select a unit from the menu'
		return;
	}if(u2_t==''){
		document.getElementById('drop_to').style.display='block'
		v.value='Select a unit from the menu';
		return;
	}
	if (u1_t != u2_t) {
        v.value = u1_t + ' to ' + u2_t + '? ʕ•ᴥ•ʔ';
        return;
    }
	if (u1 == u2) {
        v.value = u1+' to '+u2+'? Hello? ʕ•ᴥ•ʔ';
        return;
    }
	var temp=0;
    temp = evalCon(v1,u1,'default',u1_t)
	console.log(temp)
	v2 = evalCon(temp,'default',u2,u1_t)
    if (!t) {
        v.value = v2;
    } else {
        v.value = 'Cannot convert ʕ•ᴥ•ʔ'
    }
}
function evalCon(val,fr,to,type){
	var r=0;
	switch(type){
		case 'distance':
			to=to=='default'?'m':to;
			fr=fr=='default'?'m':fr;
			switch(fr+' '+to){
				case 'm km':
					r=val/1000;
				break;
				case 'cm m':
					r=val/100;
				break;
				case 'dm m':
					r=val/10;
				break;
				case 'm mm':
				case 'km m':
					r=val*1000;
				break;
				case 'm cm':
					r=val*100;
				break;
				case 'm dm':
					r=val*10;
				break;
				case 'm um':
					r=val*1000000;
				break;
				case 'um m':
					r=val/1000000;
				break;
				default:
					r=val;
				break;
			}
		break;
	}
	return r;
}
</script><h2>
