<html>
<head>
<title>VHDL Beautifier</title>
<style>
body{margin:0 auto;max-width:960px;}
textarea{width:100%;font-family:Consolas,Courier;}
.btn{
margin: 10px 10px;
padding: 5px 8px;
font-size: 16px;
line-height: 1.33;
border-radius: 3px;
color: #333;
border-color: #ccc;
cursor: pointer;
text-align: center;
white-space: nowrap;
border: 1px solid rgb(194, 194, 194);}
.btn:hover{background-color:#afd9ee}
#selectAll{display:none;}
input[type="checkbox"] + label span {
    display:inline-block;
    width:19px;
    height:19px;
    margin:-1px 4px 0 0;
    vertical-align:middle;
    cursor:pointer;
}


.hljs{display:block;overflow-x:auto;padding:.5em;-webkit-text-size-adjust:none}.hljs,.hljs-subst,.hljs-tag .hljs-title,.nginx .hljs-title{color:#000}.hljs-string,.hljs-title,.hljs-constant,.hljs-parent,.hljs-tag .hljs-value,.hljs-rules .hljs-value,.hljs-preprocessor,.hljs-pragma,.haml .hljs-symbol,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string,.hljs-template_tag,.django .hljs-variable,.smalltalk .hljs-class,.hljs-addition,.hljs-flow,.hljs-stream,.bash .hljs-variable,.apache .hljs-tag,.apache .hljs-cbracket,.tex .hljs-command,.tex .hljs-special,.erlang_repl .hljs-function_or_atom,.asciidoc .hljs-header,.markdown .hljs-header,.coffeescript .hljs-attribute{color:#800}.smartquote,.hljs-comment,.hljs-annotation,.diff .hljs-header,.hljs-chunk,.asciidoc .hljs-blockquote,.markdown .hljs-blockquote{color:#888}.hljs-number,.hljs-date,.hljs-regexp,.hljs-literal,.hljs-hexcolor,.smalltalk .hljs-symbol,.smalltalk .hljs-char,.go .hljs-constant,.hljs-change,.lasso .hljs-variable,.makefile .hljs-variable,.asciidoc .hljs-bullet,.markdown .hljs-bullet,.asciidoc .hljs-link_url,.markdown .hljs-link_url{color:#080}.hljs-label,.hljs-javadoc,.ruby .hljs-string,.hljs-decorator,.hljs-filter .hljs-argument,.hljs-localvars,.hljs-array,.hljs-attr_selector,.hljs-important,.hljs-pseudo,.hljs-pi,.haml .hljs-bullet,.hljs-doctype,.hljs-deletion,.hljs-envvar,.hljs-shebang,.apache .hljs-sqbracket,.nginx .hljs-built_in,.tex .hljs-formula,.erlang_repl .hljs-reserved,.hljs-prompt,.asciidoc .hljs-link_label,.markdown .hljs-link_label,.vhdl .hljs-attribute,.clojure .hljs-attribute,.asciidoc .hljs-attribute,.lasso .hljs-attribute,.coffeescript .hljs-property,.hljs-phony{color:#88f}.hljs-keyword,.hljs-id,.hljs-title,.hljs-built_in,.css .hljs-tag,.hljs-javadoctag,.hljs-phpdoc,.hljs-dartdoc,.hljs-yardoctag,.smalltalk .hljs-class,.hljs-winutils,.bash .hljs-variable,.apache .hljs-tag,.hljs-type,.hljs-typename,.tex .hljs-command,.asciidoc .hljs-strong,.markdown .hljs-strong,.hljs-request,.hljs-status{font-weight:700}.asciidoc .hljs-emphasis,.markdown .hljs-emphasis{font-style:italic}.nginx .hljs-built_in{font-weight:400}.coffeescript .javascript,.javascript .xml,.lasso .markup,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata{opacity:.5}
</style>
<script>
!function(e){"undefined"!=typeof exports?e(exports):(window.hljs=e({}),"function"==typeof define&&define.amd&&define([],function(){return window.hljs}))}(function(e){function n(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function t(e){return e.nodeName.toLowerCase()}function r(e,n){var t=e&&e.exec(n);return t&&0==t.index}function a(e){var n=(e.className+" "+(e.parentNode?e.parentNode.className:"")).split(/\s+/);return n=n.map(function(e){return e.replace(/^lang(uage)?-/,"")}),n.filter(function(e){return N(e)||/no(-?)highlight/.test(e)})[0]}function o(e,n){var t={};for(var r in e)t[r]=e[r];if(n)for(var r in n)t[r]=n[r];return t}function i(e){var n=[];return function r(e,a){for(var o=e.firstChild;o;o=o.nextSibling)3==o.nodeType?a+=o.nodeValue.length:1==o.nodeType&&(n.push({event:"start",offset:a,node:o}),a=r(o,a),t(o).match(/br|hr|img|input/)||n.push({event:"stop",offset:a,node:o}));return a}(e,0),n}function c(e,r,a){function o(){return e.length&&r.length?e[0].offset!=r[0].offset?e[0].offset<r[0].offset?e:r:"start"==r[0].event?e:r:e.length?e:r}function i(e){function r(e){return" "+e.nodeName+'="'+n(e.value)+'"'}l+="<"+t(e)+Array.prototype.map.call(e.attributes,r).join("")+">"}function c(e){l+="</"+t(e)+">"}function u(e){("start"==e.event?i:c)(e.node)}for(var s=0,l="",f=[];e.length||r.length;){var g=o();if(l+=n(a.substr(s,g[0].offset-s)),s=g[0].offset,g==e){f.reverse().forEach(c);do u(g.splice(0,1)[0]),g=o();while(g==e&&g.length&&g[0].offset==s);f.reverse().forEach(i)}else"start"==g[0].event?f.push(g[0].node):f.pop(),u(g.splice(0,1)[0])}return l+n(a.substr(s))}function u(e){function n(e){return e&&e.source||e}function t(t,r){return RegExp(n(t),"m"+(e.cI?"i":"")+(r?"g":""))}function r(a,i){if(!a.compiled){if(a.compiled=!0,a.k=a.k||a.bK,a.k){var c={},u=function(n,t){e.cI&&(t=t.toLowerCase()),t.split(" ").forEach(function(e){var t=e.split("|");c[t[0]]=[n,t[1]?Number(t[1]):1]})};"string"==typeof a.k?u("keyword",a.k):Object.keys(a.k).forEach(function(e){u(e,a.k[e])}),a.k=c}a.lR=t(a.l||/\b[A-Za-z0-9_]+\b/,!0),i&&(a.bK&&(a.b="\\b("+a.bK.split(" ").join("|")+")\\b"),a.b||(a.b=/\B|\b/),a.bR=t(a.b),a.e||a.eW||(a.e=/\B|\b/),a.e&&(a.eR=t(a.e)),a.tE=n(a.e)||"",a.eW&&i.tE&&(a.tE+=(a.e?"|":"")+i.tE)),a.i&&(a.iR=t(a.i)),void 0===a.r&&(a.r=1),a.c||(a.c=[]);var s=[];a.c.forEach(function(e){e.v?e.v.forEach(function(n){s.push(o(e,n))}):s.push("self"==e?a:e)}),a.c=s,a.c.forEach(function(e){r(e,a)}),a.starts&&r(a.starts,i);var l=a.c.map(function(e){return e.bK?"\\.?("+e.b+")\\.?":e.b}).concat([a.tE,a.i]).map(n).filter(Boolean);a.t=l.length?t(l.join("|"),!0):{exec:function(){return null}}}}r(e)}function s(e,t,a,o){function i(e,n){for(var t=0;t<n.c.length;t++)if(r(n.c[t].bR,e))return n.c[t]}function c(e,n){return r(e.eR,n)?e:e.eW?c(e.parent,n):void 0}function f(e,n){return!a&&r(n.iR,e)}function g(e,n){var t=x.cI?n[0].toLowerCase():n[0];return e.k.hasOwnProperty(t)&&e.k[t]}function p(e,n,t,r){var a=r?"":E.classPrefix,o='<span class="'+a,i=t?"":"</span>";return o+=e+'">',o+n+i}function d(){if(!w.k)return n(y);var e="",t=0;w.lR.lastIndex=0;for(var r=w.lR.exec(y);r;){e+=n(y.substr(t,r.index-t));var a=g(w,r);a?(B+=a[1],e+=p(a[0],n(r[0]))):e+=n(r[0]),t=w.lR.lastIndex,r=w.lR.exec(y)}return e+n(y.substr(t))}function h(){if(w.sL&&!R[w.sL])return n(y);var e=w.sL?s(w.sL,y,!0,L[w.sL]):l(y);return w.r>0&&(B+=e.r),"continuous"==w.subLanguageMode&&(L[w.sL]=e.top),p(e.language,e.value,!1,!0)}function v(){return void 0!==w.sL?h():d()}function b(e,t){var r=e.cN?p(e.cN,"",!0):"";e.rB?(M+=r,y=""):e.eB?(M+=n(t)+r,y=""):(M+=r,y=t),w=Object.create(e,{parent:{value:w}})}function m(e,t){if(y+=e,void 0===t)return M+=v(),0;var r=i(t,w);if(r)return M+=v(),b(r,t),r.rB?0:t.length;var a=c(w,t);if(a){var o=w;o.rE||o.eE||(y+=t),M+=v();do w.cN&&(M+="</span>"),B+=w.r,w=w.parent;while(w!=a.parent);return o.eE&&(M+=n(t)),y="",a.starts&&b(a.starts,""),o.rE?0:t.length}if(f(t,w))throw new Error('Illegal lexeme "'+t+'" for mode "'+(w.cN||"<unnamed>")+'"');return y+=t,t.length||1}var x=N(e);if(!x)throw new Error('Unknown language: "'+e+'"');u(x);for(var w=o||x,L={},M="",k=w;k!=x;k=k.parent)k.cN&&(M=p(k.cN,"",!0)+M);var y="",B=0;try{for(var C,j,I=0;;){if(w.t.lastIndex=I,C=w.t.exec(t),!C)break;j=m(t.substr(I,C.index-I),C[0]),I=C.index+j}m(t.substr(I));for(var k=w;k.parent;k=k.parent)k.cN&&(M+="</span>");return{r:B,value:M,language:e,top:w}}catch(A){if(-1!=A.message.indexOf("Illegal"))return{r:0,value:n(t)};throw A}}function l(e,t){t=t||E.languages||Object.keys(R);var r={r:0,value:n(e)},a=r;return t.forEach(function(n){if(N(n)){var t=s(n,e,!1);t.language=n,t.r>a.r&&(a=t),t.r>r.r&&(a=r,r=t)}}),a.language&&(r.second_best=a),r}function f(e){return E.tabReplace&&(e=e.replace(/^((<[^>]+>|\t)+)/gm,function(e,n){return n.replace(/\t/g,E.tabReplace)})),E.useBR&&(e=e.replace(/\n/g,"<br>")),e}function g(e,n,t){var r=n?x[n]:t,a=[e.trim()];return e.match(/(\s|^)hljs(\s|$)/)||a.push("hljs"),r&&a.push(r),a.join(" ").trim()}function p(e){var n=a(e);if(!/no(-?)highlight/.test(n)){var t;E.useBR?(t=document.createElementNS("http://www.w3.org/1999/xhtml","div"),t.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n")):t=e;var r=t.textContent,o=n?s(n,r,!0):l(r),u=i(t);if(u.length){var p=document.createElementNS("http://www.w3.org/1999/xhtml","div");p.innerHTML=o.value,o.value=c(u,i(p),r)}o.value=f(o.value),e.innerHTML=o.value,e.className=g(e.className,n,o.language),e.result={language:o.language,re:o.r},o.second_best&&(e.second_best={language:o.second_best.language,re:o.second_best.r})}}function d(e){E=o(E,e)}function h(){if(!h.called){h.called=!0;var e=document.querySelectorAll("pre code");Array.prototype.forEach.call(e,p)}}function v(){addEventListener("DOMContentLoaded",h,!1),addEventListener("load",h,!1)}function b(n,t){var r=R[n]=t(e);r.aliases&&r.aliases.forEach(function(e){x[e]=n})}function m(){return Object.keys(R)}function N(e){return R[e]||R[x[e]]}var E={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0},R={},x={};return e.highlight=s,e.highlightAuto=l,e.fixMarkup=f,e.highlightBlock=p,e.configure=d,e.initHighlighting=h,e.initHighlightingOnLoad=v,e.registerLanguage=b,e.listLanguages=m,e.getLanguage=N,e.inherit=o,e.IR="[a-zA-Z][a-zA-Z0-9_]*",e.UIR="[a-zA-Z_][a-zA-Z0-9_]*",e.NR="\\b\\d+(\\.\\d+)?",e.CNR="(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",e.BNR="\\b(0b[01]+)",e.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",e.BE={b:"\\\\[\\s\\S]",r:0},e.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[e.BE]},e.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[e.BE]},e.PWM={b:/\b(a|an|the|are|I|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such)\b/},e.CLCM={cN:"comment",b:"//",e:"$",c:[e.PWM]},e.CBCM={cN:"comment",b:"/\\*",e:"\\*/",c:[e.PWM]},e.HCM={cN:"comment",b:"#",e:"$",c:[e.PWM]},e.NM={cN:"number",b:e.NR,r:0},e.CNM={cN:"number",b:e.CNR,r:0},e.BNM={cN:"number",b:e.BNR,r:0},e.CSSNM={cN:"number",b:e.NR+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",r:0},e.RM={cN:"regexp",b:/\//,e:/\/[gimuy]*/,i:/\n/,c:[e.BE,{b:/\[/,e:/\]/,r:0,c:[e.BE]}]},e.TM={cN:"title",b:e.IR,r:0},e.UTM={cN:"title",b:e.UIR,r:0},e});hljs.registerLanguage("vhdl",function(e){return{cI:!0,k:{keyword:"abs access after alias all and architecture array assert attribute begin block body buffer bus case component configuration constant context cover disconnect downto default else elsif end entity exit fairness file for force function generate generic group guarded if impure in inertial inout is label library linkage literal loop map mod nand new next nor not null of on open or others out package port postponed procedure process property protected pure range record register reject release rem report restrict restrict_guarantee return rol ror select sequence severity shared signal sla sll sra srl strong subtype then to transport type unaffected units until use variable vmode vprop vunit wait when while with xnor xor resize image pathname",typename:"boolean bit character severity_level integer time delay_length natural positive string bit_vector file_open_kind file_open_status std_ulogic std_ulogic_vector std_logic std_logic_vector unsigned signed boolean_vector integer_vector real_vector time_vector"},i:"{",c:[e.CBCM,{cN:"comment",b:"--",e:"$"},e.QSM,e.CNM,{cN:"literal",b:"'(U|X|0|1|Z|W|L|H|-)'",c:[e.BE]},{cN:"attribute",b:"'[A-Za-z](_?[A-Za-z0-9])*",c:[e.BE]}]}});

function selectText(element) {
	var doc = document
		, text = element
		, range, selection
	;
	if (doc.body.createTextRange) { //ms
		range = doc.body.createTextRange();
		range.moveToElementText(text);
		range.select();
	} else if (window.getSelection) { //all others
		selection = window.getSelection();
		range = doc.createRange();
		range.selectNodeContents(text);
		selection.removeAllRanges();
		selection.addRange(range);
	}
}
</script>
</head>
<body>
<h2>VHDL Beautifier, Formatter</h2>
<h4>Beautify and format your VHDL code</h4>
<p>
Proper formatting makes code easier to read and understand.<br />
Please make a backup before you replace your code!</p>
<textarea id="in" rows="10" wrap="off"></textarea><br />
<label><input type="checkbox" id="remove_comments">Remove commments</label>
 | <label><input type="checkbox" id="remove_lines">Remove blank lines</label>
 | <label><input type="checkbox" id="remove_report">Remove REPORT</label><br />
<input type="button" class="btn" onclick="f()" value="start"/>
<input type="button" class="btn" id="selectAll" value="Select All" onclick="selectText(document.getElementById('vhdl'))"/><br />

<!-- <textarea id="out" rows="20" wrap="off"></textarea> -->
<pre id="result"><code class="vhdl" id="vhdl"></code><pre>
<script>
String.prototype.regexIndexOf = function(pattern, startIndex) {
    startIndex = startIndex || 0;
    var searchResult = this.substr(startIndex).search(pattern);
    return (-1 === searchResult) ? -1 : searchResult + startIndex;
}

String.prototype.regexLastIndexOf = function(pattern, startIndex) {
    startIndex = startIndex === undefined ? this.length : startIndex;
    var searchResult = this.substr(0, startIndex).reverse().regexIndexOf(pattern, 0);
    return (-1 === searchResult) ? -1 : this.length - ++searchResult;
}

String.prototype.reverse = function() {
    return this.split('').reverse().join('');
}

// Array Remove - By John Resig (MIT Licensed)
Array.prototype.remove = function(from, to) {
  var rest = this.slice((to || from) + 1 || this.length);
  this.length = from < 0 ? this.length + from : from;
  return this.push.apply(this, rest);
};

function matchInArray(str, regexArray,replaceArray) {
    var len = regexArray.length,i=0;
    for (; i < len; i++) {
		str=str.replace(regexArray[i],replaceArray[i]);
    }
	return str;
}

function f() {
    var input = document.getElementById("in").value;
    var remove_comments = document.getElementById("remove_comments").checked;
    var remove_lines = document.getElementById("remove_lines").checked;
    var remove_report = document.getElementById("remove_report").checked;
	
	var keyword_cap=["ABS","ACCESS","AFTER","ALIAS","ALL","AND","ARCHITECTURE","ARRAY","ASSERT","ATTRIBUTE","BEGIN","BLOCK","BODY","BUFFER","BUS","CASE","COMPONENT","CONFIGURATION","CONSTANT","CONTEXT","COVER","DISCONNECT","DOWNTO","DEFAULT","ELSE","ELSIF","END","ENTITY","EXIT","FAIRNESS","FILE","FOR","FORCE","FUNCTION","GENERATE","GENERIC","GROUP","GUARDED","IF","IMPURE","IN","INERTIAL","INOUT","IS","LABEL","LIBRARY","LINKAGE","LITERAL","LOOP","MAP","MOD","NAND","NEW","NEXT","NOR","NOT","NULL","OF","ON","OPEN","OR","OTHERS","OUT","PACKAGE","PORT","POSTPONED","PROCEDURE","PROCESS","PROPERTY","PROTECTED","PURE","RANGE","RECORD","REGISTER","REJECT","RELEASE","REM","REPORT","RESTRICT","RESTRICT_GUARANTEE","RETURN","ROL","ROR","SELECT","SEQUENCE","SEVERITY","SHARED","SIGNAL","SLA","SLL","SRA","SRL","STRONG","SUBTYPE","THEN","TO","TRANSPORT","TYPE","UNAFFECTED","UNITS","UNTIL","USE","VARIABLE","VMODE","VPROP","VUNIT","WAIT","WHEN","WHILE","WITH","XNOR","XOR"], typename_cap=["BOOLEAN","BIT","CHARACTER","INTEGER","TIME","NATURAL","POSITIVE","STRING"];
	var typename_reg=[/([\r\n ])boolean([ (;])/gi, /([\r\n ])bit([ (;])/gi, /([\r\n ])character([ (;])/gi, /([\r\n ])integer([ (;])/gi, /([\r\n ])time([ (;])/gi, /([\r\n ])natural([ (;])/gi, /([\r\n ])positive([ (;])/gi, /([\r\n ])string([ (;])/gi],keyword_reg=[/([\r\n ])abs([ (;])/gi, /([\r\n ])access([ (;])/gi, /([\r\n ])after([ (;])/gi, /([\r\n ])alias([ (;])/gi, /([\r\n ])all([ (;])/gi, /([\r\n ])and([ (;])/gi, /([\r\n ])architecture([ (;])/gi, /([\r\n ])array([ (;])/gi, /([\r\n ])assert([ (;])/gi, /([\r\n ])attribute([ (;])/gi, /([\r\n ])begin([ (;])/gi, /([\r\n ])block([ (;])/gi, /([\r\n ])body([ (;])/gi, /([\r\n ])buffer([ (;])/gi, /([\r\n ])bus([ (;])/gi, /([\r\n ])case([ (;])/gi, /([\r\n ])component([ (;])/gi, /([\r\n ])configuration([ (;])/gi, /([\r\n ])constant([ (;])/gi, /([\r\n ])context([ (;])/gi, /([\r\n ])cover([ (;])/gi, /([\r\n ])disconnect([ (;])/gi, /([\r\n ])downto([ (;])/gi, /([\r\n ])default([ (;])/gi, /([\r\n ])else([ (;])/gi, /([\r\n ])elsif([ (;])/gi, /([\r\n ])end([ (;])/gi, /([\r\n ])entity([ (;])/gi, /([\r\n ])exit([ (;])/gi, /([\r\n ])fairness([ (;])/gi, /([\r\n ])file([ (;])/gi, /([\r\n ])for([ (;])/gi, /([\r\n ])force([ (;])/gi, /([\r\n ])function([ (;])/gi, /([\r\n ])generate([ (;])/gi, /([\r\n ])generic([ (;])/gi, /([\r\n ])group([ (;])/gi, /([\r\n ])guarded([ (;])/gi, /([\r\n ])if([ (;])/gi, /([\r\n ])impure([ (;])/gi, /([\r\n ])in([ (;])/gi, /([\r\n ])inertial([ (;])/gi, /([\r\n ])inout([ (;])/gi, /([\r\n ])is([ (;])/gi, /([\r\n ])label([ (;])/gi, /([\r\n ])library([ (;])/gi, /([\r\n ])linkage([ (;])/gi, /([\r\n ])literal([ (;])/gi, /([\r\n ])loop([ (;])/gi, /([\r\n ])map([ (;])/gi, /([\r\n ])mod([ (;])/gi, /([\r\n ])nand([ (;])/gi, /([\r\n ])new([ (;])/gi, /([\r\n ])next([ (;])/gi, /([\r\n ])nor([ (;])/gi, /([\r\n ])not([ (;])/gi, /([\r\n ])null([ (;])/gi, /([\r\n ])of([ (;])/gi, /([\r\n ])on([ (;])/gi, /([\r\n ])open([ (;])/gi, /([\r\n ])or([ (;])/gi, /([\r\n ])others([ (;])/gi, /([\r\n ])out([ (;])/gi, /([\r\n ])package([ (;])/gi, /([\r\n ])port([ (;])/gi, /([\r\n ])postponed([ (;])/gi, /([\r\n ])procedure([ (;])/gi, /([\r\n ])process([ (;])/gi, /([\r\n ])property([ (;])/gi, /([\r\n ])protected([ (;])/gi, /([\r\n ])pure([ (;])/gi, /([\r\n ])range([ (;])/gi, /([\r\n ])record([ (;])/gi, /([\r\n ])register([ (;])/gi, /([\r\n ])reject([ (;])/gi, /([\r\n ])release([ (;])/gi, /([\r\n ])rem([ (;])/gi, /([\r\n ])report([ (;])/gi, /([\r\n ])restrict([ (;])/gi,  /([\r\n ])restrict_guarantee([ (;])/gi,  /([\r\n ])return([ (;])/gi, /([\r\n ])rol([ (;])/gi, /([\r\n ])ror([ (;])/gi, /([\r\n ])select([ (;])/gi, /([\r\n ])sequence([ (;])/gi, /([\r\n ])severity([ (;])/gi, /([\r\n ])shared([ (;])/gi, /([\r\n ])signal([ (;])/gi, /([\r\n ])sla([ (;])/gi, /([\r\n ])sll([ (;])/gi, /([\r\n ])sra([ (;])/gi, /([\r\n ])srl([ (;])/gi, /([\r\n ])strong([ (;])/gi, /([\r\n ])subtype([ (;])/gi, /([\r\n ])then([ (;])/gi, /([\r\n ])to([ (;])/gi, /([\r\n ])transport([ (;])/gi, /([\r\n ])type([ (;])/gi, /([\r\n ])unaffected([ (;])/gi, /([\r\n ])units([ (;])/gi, /([\r\n ])until([ (;])/gi, /([\r\n ])use([ (;])/gi, /([\r\n ])variable([ (;])/gi, /([\r\n ])vmode([ (;])/gi, /([\r\n ])vprop([ (;])/gi, /([\r\n ])vunit([ (;])/gi, /([\r\n ])wait([ (;])/gi, /([\r\n ])when([ (;])/gi, /([\r\n ])while([ (;])/gi, /([\r\n ])with([ (;])/gi, /([\r\n ])xnor([ (;])/gi, /([\r\n ])xor([ (;])/gi];
		
    input = input.replace(/(?:\r\n|\r|\n)/g, '\r\n');
    input = input.replace(/ \r\n/g, '\r\n');
    var arr = input.split("\r\n");
    var comments = [],
        comments_i = 0;
    var l = arr.length;
    var str = "",
        str1 = "";
    var k = [],
        n = 0,
        p = 0;
	var n = 0,
        j = 0;
    var tab_n = 1,
        comments_r = 0,
        str_len = 0;
    var back_tab = false,
        forward_tab = false,
        need_semi = false,
        semi_pos = 0,
        arch_pos = 0,
        begin_b = false,
        bra_comma_pos = 0,
        bra_comma_pos_b = false,
		port_b = false,
		bra_semi_pos = 0,
		bra_semi_b = false,
		bra_semi_accept = false,
		process_pos=0,
		process_b=false;
    for (i = 0; i < l; i++) {
        k = arr[i].match(/"([^"]+)"/g);
        if (k != null) {
            var u = k.length;
            for (var j = 0; j < u; j++) {
                arr[i] = arr[i].replace(k[j], encodeURIComponent(k[j]))
            }
        }

        n = arr[i].regexIndexOf(/[a-zA-Z0-9\(\&\)%]/);
        p = arr[i].indexOf("--");
        if (n < p && n >= 0) {
            var s = arr[i].substr(p);
            comments.push(s);
            arr[i] = arr[i].substr(n, p - n) + "@@comments" + (comments_i++);

        } else if (n > p && p >= 0) {
            comments.push(arr[i].substr(0));
            arr[i] = "@@comments" + (comments_i++);
        } else {
            n = n < 0 ? 0 : n;
            arr[i] = arr[i].substr(n);
        }
		if (remove_comments) {
		    arr[i] = arr[i].replace(/@@comments[0-9]+/g, '');
		}
		if (remove_report) {
		    n = arr[i].indexOf("REPORT");
			p = arr[i].indexOf(";");
			if(n>=0){
				arr[i]='';
				if(p<0){
					need_semi=true;
				}
			}else if(need_semi){
				arr[i]='';
				if(p>=0){
					need_semi=false;
				}
			}
		}
		if (remove_lines) {
		    str = arr[i].replace(/[ \t\r\n]/g, '');
		    if (str.length == 0) {
		        arr.remove(i);
		        l--;
		        i--;
		    }
		}
    }
    input = arr.join("\r\n");
    input = input.replace(/\r\n\r\n\r\n/g, '\r\n');
	
	input=matchInArray(input, keyword_reg,keyword_cap);
	input=matchInArray(input, typename_reg,typename_cap);
	
    input = input.replace(/[ ]?([&=:\-<>\+|])[ ]?/g, ' $1 ');
    input = input.replace(/[ ]?([,])[ ]?/g, '$1 ');
    input = input.replace(/[ ]?(<|:)[ ]+=[ ]?/g, ' $1= ');
    input = input.replace(/[ ]?=  >[ ]?/g, ' => ');
    input = input.replace(/(IF)[ ]?([\(\)])/g, '$1 $2');
    input = input.replace(/([\(\)])[ ]?(THEN)/gi, '$1 $2');
    input = input.replace(/([\(\)])[ ]?(and|or)[ ]?([\(\)])?/gi, '$1 $2 $3');
    input = input.replace(/ -  - /g, "--");
    input = input.replace(/ \/ = /g, " /= ");
    input = input.replace(/\r\n[ \t]+--\r\n/g, "\r\n");
    input = input.replace(/[ ]+/g, ' ');
	
    arr = input.split("\r\n");
    l = arr.length;
    for (i = 0; i < l; i++) {

        str = arr[i];
        str_len = str.length;
        semi_pos = str.indexOf(";");
        bra_semi_pos = str.indexOf(");");
        arch_pos = str.indexOf("ARCHITECTURE ");
        process_pos = str.indexOf(": PROCESS");
        if (str.indexOf("ELSIF") == 0) {
            tab_n--;
            back_tab = true;
        } else if (str.indexOf("END CASE") == 0) {
            tab_n -= 2;
        } else if (str.indexOf("END ") == 0) {
            tab_n--;
        } else if (str.indexOf("ELSE") == 0) {
            tab_n--;
            back_tab = true;
        } else if (str.indexOf("WHEN") == 0) {
            tab_n--;
            back_tab = true;
        } else if (str.indexOf("BEGIN") == 0) {
            if (begin_b) {
                tab_n--;
                back_tab = true;
                begin_b = false;
            } else {
                back_tab = true;
            }
        }else if (process_pos >= 0) {
            back_tab = true;
			process_b=true;
			begin_b = true;
			need_semi = false;
			bra_comma_pos_b = false;
			bra_semi_b = false;
			bra_semi_accept = false;
        }
        if (need_semi && semi_pos >= 0) {
            forward_tab = true;
            need_semi = false;
        }
		if (bra_semi_pos >= 0){
			if(bra_semi_pos==0||str.indexOf("));")>0){
				if(port_b){
				tab_n--;
				port_b=false;
				}
			}else if(bra_semi_accept&&bra_semi_pos>0){
				forward_tab = true;
				port_b=false;
				bra_semi_accept=false;
			}
		}
		
        if (str.regexIndexOf(/^PORT[ (]/) >= 0||str.regexIndexOf(/^GENERIC[ (]/) >= 0) {
            back_tab=true;
			port_b=true;
        }
		if (str.indexOf("(")>=0) {
			if(port_b){
				if(str.indexOf(" MAP(")>=0){
					bra_semi_accept=true;
				}
				bra_semi_b=true;
			}else if(process_b){
				process_b=false;
			}
			else{
				if(str.indexOf("(")==str_len-1){
					back_tab=true;
				}else if(str.regexIndexOf(/\([ ]+\(/)>=0&&str.indexOf("),")>=0){
					back_tab=true;
				}
				if(str.indexOf("),")>=0||bra_semi_accept){
				back_tab=false;
				bra_semi_accept=true;
				}
			}
        }
        tab_n = tab_n < 1 ? 1 : tab_n;
        if (str_len) {
            if (str.indexOf("@@comments") < 0) {
                arr[i] = (Array(tab_n).join("\t")) + str;
            } else if(str.indexOf("@@comments") == 0){
				arr[i] = arr[i].replace("@@comments" + (comments_r), comments[(comments_r++)]);
			} else {
                arr[i] = (Array(tab_n).join("\t")) + arr[i].replace("@@comments" + (comments_r), comments[(comments_r++)]);
            }
        } else {
            arr[i] = str;
        }
        arr[i] = decodeURIComponent(arr[i]);
        if (back_tab) {
            tab_n++;
            back_tab = false;
        }
        if (forward_tab) {
            tab_n--;
            forward_tab = false;
        }
        if (str.indexOf("ENTITY ") == 0) {
            tab_n++;
        }else if (str.indexOf("RECORD") == 0) {
            tab_n++;
        }else if (str.indexOf("PACKAGE ") == 0) {
            tab_n++;
        } else if (str.indexOf("FOR ") == 0) {
            tab_n++;
        } else if (str.indexOf("CASE ") == 0) {
            tab_n += 2;
        } else if (arch_pos == 0) {
            tab_n++;
			begin_b = true;
        } else if (str.indexOf("IF") == 0) {
            tab_n++;
        }
    }
    input = arr.join("\r\n");
    document.getElementById("vhdl").innerHTML = input;
    document.getElementById("selectAll").style.display = "inline-block";
    hljs.highlightBlock(document.getElementById("vhdl"));
}
</script>

</body>
</html>
