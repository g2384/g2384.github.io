<head><title>Online Cordic Calculator (Javascript)</title><style>body{font-family:consolas;}.btn{
margin: 10px 10px;
padding: 5px 8px;
font-size: 16px;
line-height: 1.33;
border-radius: 3px;
color: #333;
border-color: #ccc;
cursor: pointer;
text-align: center;
white-space: nowrap;
border: 1px solid rgb(194, 194, 194);}.btn:hover{background-color:#afd9ee}</style></head><body>
<h2>Online Cordic Calculator (Javascript)</h2>
x = <input type="text" id="x" size="32" value="1"><br />
y = <input type="text" id="y" size="32" value ="1"><br />
z = <input type="text" id="z" size="32" value ="0"><br />
cycles = <input type="text" id="cycle" size="32" value ="10"> (1 ~ <span id="a"></span>)<br /><br />
<label><input type="radio" name="radAnswer" id="vectoring" checked>Vectoring</label> <label><input type="radio" name="radAnswer" id="rotation">Rotation</label><br />

<label><input type="checkbox" class="c" id="o_bin" size="32" checked>Show binary format</label><br />
<label><input type="checkbox" class="c" id="o_hex" size="32" checked>Show Hex format</label><br />
Fixed point binary integer part length:<input type="text" class="c" id="fixed_point_in" size="2" value ="2"><br />
Fixed point binary fraction part length:<input type="text" class="c" id="fixed_point_fr" size="2" value ="30"><br />
<input type="button" class="btn" size="32" value="Calculate" onclick="calc()"><br />
<strong>Note: </strong><br />
to calculate arctan():select vectoring mode, set x=1, y=input, z=0; z[n]=arctan();<br />
to calculate sine(),cos():select rotation mode, set x=0.607252935, y=0, z=input; x[n]=cos(), y[n]=sin();<br />

<div id="r"></div>
<script>
function bin2hex(a) {
var l=Math.ceil((parseInt(document.getElementById("fixed_point_fr").value)+parseInt(document.getElementById("fixed_point_in").value))/4);
    var b = parseInt(a.replace(/ /g, ""), 2).toString(16);
    var c = "00000000000000" + b.toString();
    return c.substr(c.length - l, c.length);
}

function dec_to_fp(a) {
    var result = "";
    a = a.toString();
    if (a.indexOf(".") < 0) {
        a = a.toString() + ".0";
    }
    var b = a.split(".");
    var c = Number(b[0]);
    var k = 0,
        f = 1,
        p = 1 / (1 << 10);
    var p1 = 30,
        p2 = 58,
        p3 = parseInt(document.getElementById("fixed_point_fr").value);
    if (p3 && p2>p3) {
        p2 = p3 + 1;
    }else{
		document.getElementById("fixed_point_fr").value=p2-1;
	}
    
	if(b[0].indexOf("-0")==0){
	result="11111111111111111111";
	}else 
	if(b[0].indexOf("-")==0){
	result=(~c).toString(2);
	console.log(a,result);
	}else{
	result = c.toString(2);}
	result+= ".";

    c = Number("0." + b[1]);
    if (c > 0) {
        for (var i = 1; i < p2; i++) {
            f = f / 2;
            if (f < p) {
                f *= 10;
                c *= 10;
            }
            k = (c - f) > 0;
            result += k ? "1" : "0";
            c = k ? c - f : c;
            //console.log(result,f, c, k, c - f,p)
        }
    } else {
        result += "0";
    }
    //console.log("original result",result);
    result = result.replace(/^([01])/, "$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1$1");
    //console.log("extend integer",result);
    result = result + "0000000000000000000000000000000000000000000000000000000000000";
    //console.log("extend fraction",result);
    c = result.split(".");
    c[0] = c[0].substr(c[0].length - parseInt(document.getElementById("fixed_point_in").value), c[0].length);
    c[1] = c[1].substr(0, p3);
    result = c.join(".");
    return result;
}
two = [1, 0.5, 0.25, 0.125, 0.0625, 0.03125, 0.015625, 0.0078125,
    0.00390625, 0.001953125, 0.0009765625, 0.00048828125,
    0.000244140625, 0.0001220703125, 0.00006103515625, 0.000030517578125,
    0.0000152587890625, 0.00000762939453125, 0.000003814697265625,
    0.0000019073486328125, 9.5367431640625e-7, 4.76837158203125e-7
];

function calc() {
    var bin_b = document.getElementById("o_bin").checked;
    var hex_b = document.getElementById("o_hex").checked;
    var x = new Array(),
        y = new Array(),
        z = new Array(),
        e = [0.78539816339745, 0.46364760900081, 0.24497866312686, 0.12435499454676, 0.06241880999596, 0.03123983343027, 0.01562372862048, 0.00781234106010, 0.00390623013197, 0.00195312251648, 0.00097656218956, 0.00048828121119, 0.00024414062015, 0.00012207031189, 0.00006103515617, 0.00003051757812, 0.00001525878906, 0.00000762939453, 0.00000381469727, 0.00000190734863, 0.00000095367432, 0.00000047683716, 0.00000023841858, 0.00000011920929, 0.00000005960464, 0.00000002980232, 0.00000001490116, 0.00000000745058];

    x.push(Number(document.getElementById("x").value));
    y.push(Number(document.getElementById("y").value));
    z.push(Number(document.getElementById("z").value));
    cycle = Number(document.getElementById("cycle").value);
    var d = 0;
    var len = x.length;
    var str = "<br /><strong>RESULT: </strong><br /><strong>Decimal: </strong><br />x[0] = " + x[0] + "; y[0] = " + y[0] + "; z[0] = " + z[0] + "<br />";
    if (bin_b) {
        str += "<strong>to Fixed Point Bin: </strong><br />";
        str += "x[" + (0) + "] = " + dec_to_fp(x[0]) + "; y[" + (0) + "] = " + dec_to_fp(y[0]) + "; z[" + (0) + "] = " + dec_to_fp(z[0]) + "<br />";
    }
    if (hex_b) {
        str += "<strong>to Fixed Point Hex: </strong><br />";
        str += "x[" + (0) + "] = " + bin2hex((dec_to_fp(x[0]).replace(".", ""))) + "; y[" + (0) + "] = " + bin2hex((dec_to_fp(y[0]).replace(".", ""))) + "; z[" + (0) + "] = " + bin2hex((dec_to_fp(z[0]).replace(".", ""))) + "<br />";

    }
    str += "---------------------<br />";
	mode=document.getElementById("vectoring").checked;
    for (var i = 0; i < cycle; i++) {
	if(mode){
        d = y[i]< 0 ? 1 : -1;
		}else{
		d = z[i]< 0 ? -1 : 1;
		}
        x.push(Number(x[i] - d * y[i] * two[i]));
        y.push(Number(y[i] + d * x[i] * two[i]));
        z.push(Number(z[i] - d * e[i]));

        str += "<strong>Decimal: </strong><br />x[" + (i + 1) + "] = " + x[i + 1] + "; y[" + (i + 1) + "] = " + y[i + 1] + "; z[" + (i + 1) + "] = " + z[i + 1] + "<br />";
        if (bin_b) {
            str += "<strong>to Fixed Point Bin: </strong><br />";
            str += "x[" + (i + 1) + "] = " + dec_to_fp(x[i + 1]) + "; y[" + (i + 1) + "] = " + dec_to_fp(y[i + 1]) + "; z[" + (i + 1) + "] = " + dec_to_fp(z[i + 1]) + "<br />";
        }
        if (hex_b) {
            str += "<strong>to Fixed Point Hex: </strong><br />";
            str += "x[" + (i + 1) + "] = " + bin2hex((dec_to_fp(x[i + 1]).replace(".", ""))) + "; y[" + (i + 1) + "] = " + bin2hex((dec_to_fp(y[i + 1]).replace(".", ""))) + "; z[" + (i + 1) + "] = " + bin2hex((dec_to_fp(z[i + 1]).replace(".", ""))) + "<br />";
        }
        str += "---------------------<br />";
    }
    document.getElementById("r").innerHTML = str;
}
document.getElementById("a").innerHTML = two.length;

</script></body>
