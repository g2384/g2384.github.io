<html>
<header>
  <meta charset="utf-8" />
  <title>拼音密码破解</title>
  <style>
    body {
      font-family: consolas;
      max-width: 600px;
      margin: 10px auto;
      font-size: 1.2em;
    }

    #progress {
      display: inline-block;
    }

    #progressContainer, #countContainer {
      display: none;
    }

    #count{
      display: inline;
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 5px;
      font-size: 1.2em;
    }

    .btn {
      margin: 10px 0px;
      padding: 5px 8px;
      border-radius: 3px;
      color: #000;
      font-size: 1em;
      cursor: pointer;
      text-align: center;
      background-color: white;
      border: 1px solid rgb(194, 194, 194);
    }

    .btn:hover {
      background-color: #ebebeb;
      color: #4e4e4e;
      border: 1px solid rgb(226, 226, 226);
    }

    #knownKeys {
      margin: 10px 0px;
    }

    .inlineBlock {
      display: inline-block;
      margin: 2px 10;
    }

    input[type=text] {
      padding: 5px;
      width: 40px;
    }
  </style>
</header>

<body>
  <h3>拼音密码破解</h3>
  <p>暴力破解拼音字母替换的密码</p>
  <div>
    <p>密文：（不区分大小写）</p>
    <textarea id="inputText">love</textarea>
    <p>已知的替换：（选填，左侧为密文里出现的字母，右侧为明文里出现的字母）</p>
    <div id="knownKeys"></div>
    <input type="button" class="btn" onclick="start();" value="开始" />
  </div>

  <div id="countContainer">已检查：
    <div id="count"></div>组
  </div>
  <div id="progressContainer">Checking: <div id="progress"></div>
  </div>
  <hr>
  <div id="result"></div>
  <script>
    const alpha2 = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];

    function setUI() {
      var knownKeys = document.getElementById("knownKeys");
      var html = "";
      alpha2.forEach(function (v, i) {
        html += "<div class='inlineBlock'>" + v + ": <input type='text' maxLength='1' id='i_" + v + "'/></div>"
      });
      knownKeys.innerHTML = html;
    }
    setUI();

    var progressArea = document.getElementById("progress");
    var countArea = document.getElementById("count");
    var resultDiv = document.getElementById("result");

    if ("function" !== typeof window.Worker) {
      throw "Your browser doesn't support Web Workers";
    }

    var thread = new Worker("pinyin-decipher.js");
    thread.onmessage = function (e) {
      [isValid, text, curr_c] = e.data;
      if (isValid) {
        if (text == "!") {
          document.getElementById("progressContainer").style.display = "none";
        } else {
          var text2 = text.replaceAll(" ", "");
          if (deciphered.indexOf(text2) < 0) {
            deciphered.push(text2);
            resultDiv.innerHTML += text + "<br>";
          }
        }
      }
      else {
        progressArea.innerHTML = text;
      }
      count += curr_c;
      countArea.innerHTML = count;
    };

    thread.onerror = function (e) {
      console.log(e);
    };

    var count = 0;
    var deciphered = [];

    function start() {
      document.getElementById("progressContainer").style.display = "block";
      document.getElementById("countContainer").style.display = "block";
      count = 0;
      deciphered = [];
      progressArea.innerHTML = count;
      console.log("start");
      var keys = getKeys();
      var text = document.getElementById("inputText").value;
      thread.postMessage([text, keys]);
    }

    function getKeys() {
      var keys = {}
      alpha2.forEach(function (v, i) {
        var key = document.getElementById("i_" + v).value;
        if (key != null && key != undefined && key.length > 0) {
          keys[v.toLowerCase()] = key;
        }
      });
      return keys;
    }


    function test() {
      var pp = ["a", "e", "o", "ai", "an", "ao", "ba", "bi", "bo", "bu", "ca", "ce", "ci", "cu", "da", "de", "di", "du", "ei", "en", "er", "fa", "fo", "fu", "ga", "ge", "gu", "ha", "he", "hu", "ji", "ju", "ka", "ke", "ku", "la", "le", "li", "lo", "lu", "lv", "ma", "me", "mi", "mo", "mu", "na", "ne", "ni", "nu", "nv", "ou", "pa", "pi", "po", "pu", "qi", "qu", "re", "ri", "ru", "sa", "se", "si", "su", "ta", "te", "ti", "tu", "wa", "wo", "wu", "xi", "xu", "ya", "ye", "yi", "yo", "yu", "za", "ze", "zi", "zu", "ang", "bai", "ban", "bao", "bei", "ben", "bie", "bin", "cai", "can", "cao", "cen", "cha", "che", "chi", "chu", "cou", "cui", "cun", "cuo", "dai", "dan", "dao", "dei", "den", "dia", "die", "diu", "dou", "dui", "dun", "duo", "eng", "fan", "fei", "fen", "fou", "gai", "gan", "gao", "gei", "gen", "gou", "gua", "gui", "gun", "guo", "hai", "han", "hao", "hei", "hen", "hng", "hou", "hua", "hui", "hun", "huo", "jia", "jie", "jin", "jiu", "jue", "jun", "kai", "kan", "kao", "kei", "ken", "kou", "kua", "kui", "kun", "kuo", "lai", "lan", "lao", "lei", "lia", "lie", "lin", "liu", "lou", "lve", "lun", "luo", "mai", "man", "mao", "mei", "men", "mie", "min", "miu", "mou", "nai", "nan", "nao", "nei", "nen", "nie", "nin", "niu", "nou", "nve", "nuo", "pai", "pan", "pao", "pei", "pen", "pie", "pin", "pou", "qia", "qie", "qin", "qiu", "que", "qun", "ran", "rao", "ren", "rou", "rui", "run", "ruo", "sai", "san", "sao", "sen", "sha", "she", "shi", "shu", "sou", "sui", "sun", "suo", "tai", "tan", "tao", "tie", "tou", "tui", "tun", "tuo", "wai", "wan", "wei", "wen", "xia", "xie", "xin", "xiu", "xue", "xun", "yan", "yao", "yin", "you", "yue", "yun", "zai", "zan", "zao", "zei", "zen", "zha", "zhe", "zhi", "zhu", "zou", "zui", "zun", "zuo", "bang", "beng", "bian", "biao", "bing", "cang", "ceng", "chai", "chan", "chao", "chen", "chou", "chua", "chui", "chun", "chuo", "cong", "cuan", "dang", "deng", "dian", "diao", "ding", "dong", "duan", "fang", "feng", "gang", "geng", "gong", "guai", "guan", "hang", "heng", "hong", "huai", "huan", "jian", "jiao", "jing", "juan", "kang", "keng", "kong", "kuai", "kuan", "lang", "leng", "lian", "liao", "ling", "long", "luan", "mang", "meng", "mian", "miao", "ming", "nang", "neng", "nian", "niao", "ning", "nong", "nuan", "pang", "peng", "pian", "piao", "ping", "qian", "qiao", "qing", "quan", "rang", "reng", "rong", "ruan", "sang", "seng", "shai", "shan", "shao", "shei", "shen", "shou", "shua", "shui", "shun", "shuo", "song", "suan", "tang", "teng", "tian", "tiao", "ting", "tong", "tuan", "wang", "weng", "xian", "xiao", "xing", "xuan", "yang", "ying", "yong", "yuan", "zang", "zeng", "zhai", "zhan", "zhao", "zhei", "zhen", "zhou", "zhua", "zhui", "zhun", "zhuo", "zong", "zuan", "chang", "cheng", "chong", "chuai", "chuan", "guang", "huang", "jiang", "jiong", "kuang", "liang", "niang", "qiang", "qiong", "shang", "sheng", "shuai", "shuan", "xiang", "xiong", "zhang", "zheng", "zhong", "zhuai", "zhuan", "chuang", "shuang", "zhuang"];
      var alpha = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"];
      var alpha2 = findAllCombo(alpha, alpha);
      console.log(alpha2);
      var pp2 = findAllCombo(pp, pp);
      console.log(pp2);
      var valid = [];
      var invalid = [];
      for (var i = 0; i < alpha2.length; i++) {
        var found = false;
        for (var j = 0; j < pp2.length; j++) {
          if (pp2[j].indexOf(alpha2[i]) >= 0) {
            found = true;
            break;
          }
        }
        if (!found) {
          invalid.push(alpha2[i]);
        }
        else {
          valid.push(alpha2[i]);
        }
      }
      console.log(valid.join(", "));
      console.log(invalid.join(", "));


      for (var i = 0; i < pp2.length; i++) {
        var index = pp.indexOf(pp2[i]);
        if (index >= 0) {
          pp[index] = "";
        }
      }
      console.log(pp.join(", "));


      for (var j = 0; j < 6; j++) {
        var result = "";
        for (var i = 0; i < pp.length; i++) {
          if (pp[i].length > j) {
            result += pp[i][j] + " ";
          }
        }
        console.log(result);
      }

    }

    function findAllCombo(array1, array2) {
      combos = [] //or combos = new Array(2);

      for (var i = 0; i < array1.length; i++) {
        for (var j = 0; j < array2.length; j++) {
          //you would access the element of the array as array1[i] and array2[j]
          //create and array with as many elements as the number of arrays you are to combine
          //add them in
          //you could have as many dimensions as you need
          combos.push(array1[i] + array2[j])
        }
      }
      return combos;
    }

  </script>
</body>

</html>