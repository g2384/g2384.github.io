
<html>
<head>
<meta charset="UTF-8" />
<title>
Text 2 Image
</title>
</head>
<body>
<div style="float: left"><textarea id="txt" style="width: 450px; height: 400px;">Test 中文</textarea></div>
<div style="float: left; width:200px;">
<table>
	<tr>
		<td><label>Font:</label>
		<select id="fontName">
			<option value="宋体">宋体</option>
			<option value="黑体">黑体</option>
			<option value="Verdana">Verdana</option>
			<option value="Arial">Arial</option>
			<option value="Times New Roman">Times New Roman</option>
			<option value="Georgia">Georgia</option>
			<option value="Courier New">Courier New</option>
			<option value="Lucida Console">Lucida Console</option>
		</select></td>
		
	</tr><tr>
		<td><label>Size:</label><input size="4" id='fontSize' value='15' />px</td>
	</tr>
	<tr>
		<td><label>Weight:</label><select id="fontWeight">
			<option value="normal">Normal</option>
			<option value="bold">Bold</option>
		</select></td>
	</tr>
	<tr>
		<td><label>Each line:</label><input size="4" id='len' value="40" />letters</td>
	</tr>
	<tr>
		<td>Text color:<canvas id="text" width="25" height="25"></canvas><br>
		R: <input type="range" id="red" min="0" max="255" value="0"
			onchange="changeColor();" /><br>
		G: <input type="range" id="green" min="0" max="255"
			value="0" onchange="changeColor();" /><br>
		B: <input type="range" id="blue" min="0" max="255" value="0"
			onchange="changeColor();" /><br>
		Color: <input type=text size="7" id="showcolor"></input></td>
	</tr>
	<tr>
		<td>
		Border left: <input type="text" id="border_left" size="4" value="10"/><br>
		Border right: <input type="text" id="border_right" size="4" value="10"/><br>
		Border top: <input type="text" id="border_top" size="4" value="10"/><br>
		Border bottom: <input type="text" id="border_bottom" size="4" value="10"/><br>
		</td>
	</tr>
	<tr>
		<td>
		<button onclick="textToImg();">Generate</button>
		</td>
	</tr>
</table>
</div>
<canvas id="canvas" style="display:block"></canvas>
<img id="img" style="border: 1px dotted" />
<div id="info"></div>
<script>
//adapted from: http://www.oschina.net/code/snippet_84535_10015#16156
	function $(id) {
		return document.getElementById(id);
	}
	function textToImg() {
		var len = $('len').value || 30;
		var i = 0;
		var fontSize = $('fontSize').value || 15;
		var fontName = $('fontName').value || 'Arial';
		var fontWeight = $('fontWeight').value || 'normal';
		var txt = $("txt").value;
		var border_left = parseInt($('border_left').value);
		var border_right = parseInt($('border_right').value);
		var border_top = parseInt($('border_top').value);
		var border_bottom = parseInt($('border_bottom').value);
		var canvas = $('canvas');
		if (txt == '') {
			txt='Test 中文';
		}
		if (len > txt.length) {
			len = txt.length;
		}
		canvas.width = fontSize * len+border_left+border_right;
		canvas.height = border_top+border_bottom+fontSize * (3 / 2)
				* (Math.ceil(txt.length / len) + txt.split('\n').length - 1);
		var context = canvas.getContext('2d');
		context.clearRect(0, 0, canvas.width, canvas.height);
		context.fillStyle = $("showcolor").value;
		context.font = fontWeight + ' ' + fontSize + 'px '+fontName;
		context.textBaseline = 'top';
		canvas.style.display = 'none';
		console.log(txt.length);
		function fillTxt(text) {
			while (text.length > len) {
				var txtLine = text.substring(0, len);
				text = text.substring(len);
				context.fillText(txtLine, border_left, border_top+fontSize * (3 / 2) * i++,	canvas.width);
			}
			context.fillText(text, border_left, border_top+fontSize * (3 / 2) * i, canvas.width);
		}
		var txtArray = txt.split('\n');
		for ( var j = 0; j < txtArray.length; j++) {
			fillTxt(txtArray[j]);
			context.fillText('\n', border_left, border_top+fontSize * (3 / 2) * i++, canvas.width);
		}
		var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
		var img = $("img");
		img.src = canvas.toDataURL("image/png");
		$('info').innerHTML='Right Click, "save as..."';
	}
	function changeColor() {
		var c = $("text");
		var ctx = c.getContext("2d");
		var red = $("red");
		var green = $("green");
		var blue = $("blue");
		ctx.fillStyle = "rgb(" + red.value + "," + green.value + ","
				+ blue.value + ")";
		$("showcolor").value = ctx.fillStyle;
		ctx.fillRect(0, 0, 100, 100);
	}
	changeColor();
</script>
</body>
</html>
